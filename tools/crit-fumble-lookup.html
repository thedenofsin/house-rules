<!-- Save as: tools/crit-fumble-lookup.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crit/Fumble Lookup</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#11131a;
      --text:#e7e9ee;
      --muted:#b7bcc7;
      --line:#2a2f3a;
      --accent:#9ad5ff;
      --chip:#1a2030;
      --bad:#ffb3b3;
      --good:#b7ffcf;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.45;
    }
    header{
      padding:22px 16px 10px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(154,213,255,0.10), rgba(0,0,0,0));
    }
    .wrap{max-width:1000px;margin:0 auto;padding:0 16px;}
    h1{margin:0 0 6px;font-size:1.45rem}
    .sub{color:var(--muted);margin:0 0 10px}
    nav a{color:var(--accent);text-decoration:none;margin-right:14px;font-weight:600;}
    nav a:hover{text-decoration:underline}

    main{padding:18px 0 36px;}
    .panel{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
      margin:14px 0;
    }
    label{display:block;color:var(--muted);margin:0 0 8px;font-weight:600;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input{
      width:180px;
      max-width:100%;
      padding:10px 12px;
      font-size:1rem;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0e1017;
      color:var(--text);
      outline:none;
    }
    input:focus{border-color:rgba(154,213,255,0.7)}
    button{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0e1017;
      color:var(--text);
      font-weight:700;
      cursor:pointer;
    }
    button:hover{border-color:rgba(154,213,255,0.7)}
    .hint{color:var(--muted);margin:8px 0 0;font-size:0.95rem}
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (min-width: 900px){
      .grid{grid-template-columns: 1fr 1fr;}
    }
    h2{margin:0 0 10px;font-size:1.1rem}
    .chip{
      display:inline-block;
      background:var(--chip);
      border:1px solid var(--line);
      padding:2px 8px;
      border-radius:999px;
      font-size:0.78rem;
      color:var(--muted);
      margin-left:6px;
      white-space:nowrap;
    }
    table{
      width:100%;
      border-collapse:collapse;
      border:1px solid var(--line);
      border-radius:10px;
      overflow:hidden;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      text-align:left;
    }
    th{background:rgba(255,255,255,0.03);color:var(--text);font-size:0.95rem}
    td{color:var(--text);font-size:0.95rem}
    tr:last-child td{border-bottom:none}
    .muted{color:var(--muted)}
    .warn{color:var(--bad);font-weight:700}
    .ok{color:var(--good);font-weight:700}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Crit / Fumble Lookup</h1>
      <p class="sub">Enter a d100 roll. You’ll see the result for Martial / Semi-martial / Non-martial for both tables.</p>
      <nav>
        <a href="../index.html">Home</a>
        <a href="../crits-and-fumbles.html">Tables</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="panel">
      <label for="roll">d100 roll</label>
      <div class="row">
        <input id="roll" inputmode="numeric" autocomplete="off" placeholder="1–100 (or 00)" />
        <button id="lookupBtn">Lookup</button>
        <button id="clearBtn">Clear</button>
      </div>
      <div class="hint">
        Accepts <span class="mono">0</span> or <span class="mono">00</span> as <strong>100</strong>. Press <span class="mono">Enter</span> to lookup.
      </div>
      <div id="msg" class="hint"></div>
    </div>

    <div class="grid">
      <section class="panel">
        <h2>Critical Hits</h2>
        <table aria-label="Critical Lookup">
          <thead>
            <tr>
              <th>Martial</th>
              <th>Semi-martial <span class="chip">All Monsters</span></th>
              <th>Non-martial</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="critM" class="muted">—</td>
              <td id="critS" class="muted">—</td>
              <td id="critN" class="muted">—</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section class="panel">
        <h2>Fumbles</h2>
        <table aria-label="Fumble Lookup">
          <thead>
            <tr>
              <th>Martial <span class="chip">Monsters</span></th>
              <th>Semi-martial Martial <span class="chip">Humanoid monsters</span></th>
              <th>Non-martial</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="fumM" class="muted">—</td>
              <td id="fumS" class="muted">—</td>
              <td id="fumN" class="muted">—</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
  </main>

  <script>
    "use strict";

    // Normalize input:
    // - "00" or "0" => 100
    // - "1".."100" => that number
    function parseD100(raw) {
      if (!raw) return { ok:false, err:"Enter a number from 1–100 (or 00)." };
      const s = String(raw).trim();

      // Allow "00"
      if (s === "00" || s === "0") return { ok:true, value:100 };

      // Digits only
      if (!/^\d+$/.test(s)) return { ok:false, err:"Digits only. Use 1–100 (or 00)." };

      const n = Number(s);
      if (!Number.isFinite(n)) return { ok:false, err:"Invalid number." };
      if (n < 1 || n > 100) return { ok:false, err:"Out of range. Use 1–100 (or 00)." };

      return { ok:true, value:n };
    }

    // CRIT TABLE (single roll, per column)
    function critResult(category, r) {
      // r is 1..100 (with 100 representing 00)
      if (r === 100) return "Immediate death. No save.";

      // Category bands from the finalized table
      // Martial: Max 1-64, Double Damage 65-89, Triple Damage 90-99
      // Semi:    Max 1-72, Double Damage 73-93, Triple Damage 94-99
      // Non:     Max 1-80, Double Damage 81-95, Triple Damage 96-99
      const bands = {
        M: { maxEnd:64, ddStart:65, ddEnd:89, tdStart:90, tdEnd:99 },
        S: { maxEnd:72, ddStart:73, ddEnd:93, tdStart:94, tdEnd:99 },
        N: { maxEnd:80, ddStart:81, ddEnd:95, tdStart:96, tdEnd:99 },
      };
      const b = bands[category];

      if (r <= b.maxEnd) return "Max damage.";

      // Double Damage rows / mappings
      // We map each column roll number to the corresponding Double Damage effect.
      // For simplicity and speed: build explicit per-category ranges.
      const dd = {
        M: [
          { lo:65, hi:66, txt:"Double Damage; If target has groin, strike to groin. Target stunned for 1 round." },
          { lo:67, hi:68, txt:"Double Damage; If target has head, strike to head. Target stunned for 2 rounds." },
          { lo:69, hi:70, txt:"Double Damage; If target has fingers, fingers damaged. Target drops weapon in hand." },
          { lo:71, hi:72, txt:"Double Damage; If target has eyes, strike to eyes. Target is blinded for 1d2 rounds." },
          { lo:73, hi:74, txt:"Double Damage; If target has nose, nose shattered into sinus cavity. Stunned for 1d3 rounds." },
          { lo:75, hi:75, txt:"Double Damage; If target has ears, massive ear injury. Unable to hear due to tinnitus until healed." },
          // Note: 76–79 are other Double Damage effects; 80 is brain per your table ordering
          { lo:76, hi:77, txt:"Double Damage; If target has ribs, rib injury. -2 AC until healed." },
          { lo:78, hi:79, txt:"Double Damage; If target has armor, armor sundered and ribs injured. -4 AC if wearing armor, -2 if not." },
          { lo:80, hi:80, txt:"Double Damage; If target has brain, brain damage; SAVE or fall prone for 1d3 rounds." },
          { lo:81, hi:82, txt:"Double Damage; If target has throat, throat damaged. Unable to speak until healed." },
          { lo:83, hi:84, txt:"Double Damage; If target has arms, arm injury. -4 strength until healed. Cannot wield 2-handed weapons until healed." },
          { lo:85, hi:85, txt:"Double Damage; If target has jaw, jaw broken. 2:4 chance for spells to fizzle until healed." },
          { lo:86, hi:86, txt:"Double Damage; If target has internal organs, massive internal injury. Stunned for 2 rounds. Silenced for 1d4 rounds (coughing blood)." },
          { lo:87, hi:88, txt:"Double Damage; If target has leg, leg bone broken; +1d6 damage and prone for 2 rounds. Speed reduced by 50% until healed." },
          { lo:89, hi:89, txt:"Double Damage; If target has hips, hip injury; +1d6 damage. Pelvis fractured; fall and prone 3 rounds. -5 dexterity until healed. Speed reduced to 0 until healed." },
        ],
        S: [
          { lo:73, hi:74, txt:"Double Damage; If target has groin, strike to groin. Target stunned for 1 round." },
          { lo:75, hi:75, txt:"Double Damage; If target has head, strike to head. Target stunned for 2 rounds." },
          { lo:76, hi:77, txt:"Double Damage; If target has fingers, fingers damaged. Target drops weapon in hand." },
          { lo:78, hi:79, txt:"Double Damage; If target has eyes, strike to eyes. Target is blinded for 1d2 rounds." },
          { lo:80, hi:80, txt:"Double Damage; If target has nose, nose shattered into sinus cavity. Stunned for 1d3 rounds." },
          { lo:81, hi:81, txt:"Double Damage; If target has ears, massive ear injury. Unable to hear due to tinnitus until healed." },
          { lo:82, hi:82, txt:"Double Damage; If target has brain, brain damage; SAVE or fall prone for 1d3 rounds." },
          { lo:83, hi:83, txt:"Double Damage; If target has throat, throat damaged. Unable to speak until healed." },
          { lo:84, hi:85, txt:"Double Damage; If target has ribs, rib injury. -2 AC until healed." },
          { lo:86, hi:86, txt:"Double Damage; If target has armor, armor sundered and ribs injured. -4 AC if wearing armor, -2 if not." },
          { lo:87, hi:88, txt:"Double Damage; If target has arms, arm injury. -4 strength until healed. Cannot wield 2-handed weapons until healed." },
          { lo:89, hi:89, txt:"Double Damage; If target has jaw, jaw broken. 2:4 chance for spells to fizzle until healed." },
          { lo:90, hi:90, txt:"Double Damage; If target has internal organs, massive internal injury. Stunned for 2 rounds. Silenced for 1d4 rounds (coughing blood)." },
          { lo:91, hi:92, txt:"Double Damage; If target has leg, leg bone broken; +1d6 damage and prone for 2 rounds. Speed reduced by 50% until healed." },
          { lo:93, hi:93, txt:"Double Damage; If target has hips, hip injury; +1d6 damage. Pelvis fractured; fall and prone 3 rounds. -5 dexterity until healed. Speed reduced to 0 until healed." },
        ],
        N: [
          { lo:81, hi:81, txt:"Double Damage; If target has groin, strike to groin. Target stunned for 1 round." },
          { lo:82, hi:82, txt:"Double Damage; If target has head, strike to head. Target stunned for 2 rounds." },
          { lo:83, hi:83, txt:"Double Damage; If target has fingers, fingers damaged. Target drops weapon in hand." },
          { lo:84, hi:84, txt:"Double Damage; If target has eyes, strike to eyes. Target is blinded for 1d2 rounds." },
          { lo:85, hi:85, txt:"Double Damage; If target has nose, nose shattered into sinus cavity. Stunned for 1d3 rounds." },
          { lo:86, hi:86, txt:"Double Damage; If target has ears, massive ear injury. Unable to hear due to tinnitus until healed." },
          { lo:87, hi:87, txt:"Double Damage; If target has brain, brain damage; SAVE or fall prone for 1d3 rounds." },
          { lo:88, hi:88, txt:"Double Damage; If target has throat, throat damaged. Unable to speak until healed." },
          { lo:89, hi:89, txt:"Double Damage; If target has ribs, rib injury. -2 AC until healed." },
          { lo:90, hi:90, txt:"Double Damage; If target has armor, armor sundered and ribs injured. -4 AC if wearing armor, -2 if not." },
          { lo:91, hi:91, txt:"Double Damage; If target has arms, arm injury. -4 strength until healed. Cannot wield 2-handed weapons until healed." },
          { lo:92, hi:92, txt:"Double Damage; If target has jaw, jaw broken. 2:4 chance for spells to fizzle until healed." },
          { lo:93, hi:93, txt:"Double Damage; If target has internal organs, massive internal injury. Stunned for 2 rounds. Silenced for 1d4 rounds (coughing blood)." },
          { lo:94, hi:94, txt:"Double Damage; If target has leg, leg bone broken; +1d6 damage and prone for 2 rounds. Speed reduced by 50% until healed." },
          { lo:95, hi:95, txt:"Double Damage; If target has hips, hip injury; +1d6 damage. Pelvis fractured; fall and prone 3 rounds. -5 dexterity until healed. Speed reduced to 0 until healed." },
        ],
      };

      // Triple Damage rows / mappings
      const td = {
        M: [
          { lo:90, hi:92, txt:"Triple Damage; If target has arms, massive arm injury; +1d8 damage. Save or arm is severed/shattered and useless." },
          { lo:93, hi:95, txt:"Triple Damage; If target has leg, leg severed below knee/disintegrated. Target falls prone for 3 rounds. DEX reduced to 3." },
          { lo:96, hi:97, txt:"Triple Damage; If target has spine, spinal cord injury. Paralyzed for 2d4 rounds. Save or permanently paralyzed until healed." },
          { lo:98, hi:99, txt:"Triple Damage; If target has skull, skull caved in. -7 intelligence. 50% of memorized spells lost. Save or die." },
        ],
        S: [
          { lo:94, hi:95, txt:"Triple Damage; If target has arms, massive arm injury; +1d8 damage. Save or arm is severed/shattered and useless." },
          { lo:96, hi:97, txt:"Triple Damage; If target has leg, leg severed below knee/disintegrated. Target falls prone for 3 rounds. DEX reduced to 3." },
          { lo:98, hi:98, txt:"Triple Damage; If target has spine, spinal cord injury. Paralyzed for 2d4 rounds. Save or permanently paralyzed until healed." },
          { lo:99, hi:99, txt:"Triple Damage; If target has skull, skull caved in. -7 intelligence. 50% of memorized spells lost. Save or die." },
        ],
        N: [
          { lo:96, hi:96, txt:"Triple Damage; If target has arms, massive arm injury; +1d8 damage. Save or arm is severed/shattered and useless." },
          { lo:97, hi:97, txt:"Triple Damage; If target has leg, leg severed below knee/disintegrated. Target falls prone for 3 rounds. DEX reduced to 3." },
          { lo:98, hi:98, txt:"Triple Damage; If target has spine, spinal cord injury. Paralyzed for 2d4 rounds. Save or permanently paralyzed until healed." },
          { lo:99, hi:99, txt:"Triple Damage; If target has skull, skull caved in. -7 intelligence. 50% of memorized spells lost. Save or die." },
        ],
      };

      // If in Double Damage band, find matching Double Damage entry
      if (r >= b.ddStart && r <= b.ddEnd) {
        const arr = dd[category];
        for (const e of arr) {
          if (r >= e.lo && r <= e.hi) return e.txt;
        }
        // Fallback (shouldn't happen if mapping is correct)
        return "Double Damage; (mapping error — check table ranges).";
      }

      // If in Triple Damage band, find matching Triple Damage entry
      if (r >= b.tdStart && r <= b.tdEnd) {
        const arr = td[category];
        for (const e of arr) {
          if (r >= e.lo && r <= e.hi) return e.txt;
        }
        return "Triple Damage; (mapping error — check table ranges).";
      }

      return "(No result — check table logic.)";
    }

    // FUMBLE TABLE (single roll, per column)
    function fumbleResult(category, r) {
      if (r === 100) return "Freak accident. Immediate death. No save.";

      // Martial: 1-50 slip, 51-80 stumble, 81..99 specifics
      // Semi:    1-42 slip, 43-72 stumble, 73..99 specifics
      // Non:     1-34 slip, 35-64 stumble, 65..99 specifics
      const slipEnd = { M:50, S:42, N:34 }[category];
      const stEnd   = { M:80, S:72, N:64 }[category];

      if (r <= slipEnd) return "Slip, lose action.";
      if (r <= stEnd) return "Stumble, lose footing, -1 AC penalty for 1 round.";

      // Specific mapping from your finalized fumble table
      const map = {
        M: [
          { lo:81, hi:81, txt:"Trip, fall, bang head; stunned for 1 round. No effect if wearing a helmet." },
          { lo:82, hi:82, txt:"Lose grip, drop weapon (or focus); roll 1d8 direction, 3d4 distance (feet)." },
          { lo:83, hi:83, txt:"Weapon/armor malfunction; unable to attack for 2 rounds until issue resolved." },
          { lo:84, hi:84, txt:"Helmet slips / blood / sweat in eyes; blinded for 1 round." },
          { lo:85, hi:85, txt:"Stumble; genitals slammed. Stunned for 1 round." },
          { lo:86, hi:86, txt:"Armor malfunction (no effect if no armor); -3 AC penalty until out of combat and can fix armor." },
          { lo:87, hi:87, txt:"Poke self in eye; 1d6 damage and blinded for 1 round." },
          { lo:88, hi:88, txt:"Hit self for 50% damage." },
          { lo:89, hi:89, txt:"Severe ankle injury; lose action. 2d4 subdual damage; -2 DEX & speed reduced by 10’ until healed." },
          { lo:90, hi:90, txt:"Jam toes; stumble forward 10 feet, falling prone for 1 round." },
          { lo:91, hi:91, txt:"Slip, fall, break leg. 2d6 damage and prone for 1 round. Speed cannot exceed 10’ until healed." },
          { lo:92, hi:92, txt:"Slip, fall, bang head; unconscious for 2d4 rounds. If wearing a helmet, helmet falls off." },
          { lo:93, hi:93, txt:"Save or weapon breaks. For magical items, add +3 to each level above mundane." },
          { lo:94, hi:94, txt:"Hit self, max damage." },
          { lo:95, hi:95, txt:"Hit closest ally, max damage. If an ally is not in range, hit self." },
          { lo:96, hi:96, txt:"Hit self, double damage." },
          { lo:97, hi:97, txt:"Hit closest ally, double damage. If an ally is not in range, hit self." },
          { lo:98, hi:98, txt:"Hit self, triple damage + roll on crit table for any additional effects (no increase to damage)." },
          { lo:99, hi:99, txt:"Hit closest ally, triple damage + roll on crit table for any additional effects (no increase to damage). If an ally is not in range, hit self." },
        ],
        S: [
          { lo:73, hi:74, txt:"Trip, fall, bang head; stunned for 1 round. No effect if wearing a helmet." },
          { lo:75, hi:76, txt:"Lose grip, drop weapon (or focus); roll 1d8 direction, 3d4 distance (feet)." },
          { lo:77, hi:78, txt:"Weapon/armor malfunction; unable to attack for 2 rounds until issue resolved." },
          { lo:79, hi:80, txt:"Helmet slips / blood / sweat in eyes; blinded for 1 round." },
          { lo:81, hi:82, txt:"Stumble; genitals slammed. Stunned for 1 round." },
          { lo:83, hi:84, txt:"Armor malfunction (no effect if no armor); -3 AC penalty until out of combat and can fix armor." },
          { lo:85, hi:86, txt:"Poke self in eye; 1d6 damage and blinded for 1 round." },
          { lo:87, hi:88, txt:"Hit self for 50% damage." },
          { lo:89, hi:89, txt:"Severe ankle injury; lose action. 2d4 subdual damage; -2 DEX & speed reduced by 10’ until healed." },
          { lo:90, hi:90, txt:"Jam toes; stumble forward 10 feet, falling prone for 1 round." },
          { lo:91, hi:91, txt:"Slip, fall, break leg. 2d6 damage and prone for 1 round. Speed cannot exceed 10’ until healed." },
          { lo:92, hi:92, txt:"Slip, fall, bang head; unconscious for 2d4 rounds. If wearing a helmet, helmet falls off." },
          { lo:93, hi:93, txt:"Save or weapon breaks. For magical items, add +3 to each level above mundane." },
          { lo:94, hi:94, txt:"Hit self, max damage." },
          { lo:95, hi:95, txt:"Hit closest ally, max damage. If an ally is not in range, hit self." },
          { lo:96, hi:96, txt:"Hit self, double damage." },
          { lo:97, hi:97, txt:"Hit closest ally, double damage. If an ally is not in range, hit self." },
          { lo:98, hi:98, txt:"Hit self, triple damage + roll on crit table for any additional effects (no increase to damage)." },
          { lo:99, hi:99, txt:"Hit closest ally, triple damage + roll on crit table for any additional effects (no increase to damage). If an ally is not in range, hit self." },
        ],
        N: [
          { lo:65, hi:66, txt:"Trip, fall, bang head; stunned for 1 round. No effect if wearing a helmet." },
          { lo:67, hi:68, txt:"Lose grip, drop weapon (or focus); roll 1d8 direction, 3d4 distance (feet)." },
          { lo:69, hi:70, txt:"Weapon/armor malfunction; unable to attack for 2 rounds until issue resolved." },
          { lo:71, hi:72, txt:"Helmet slips / blood / sweat in eyes; blinded for 1 round." },
          { lo:73, hi:74, txt:"Stumble; genitals slammed. Stunned for 1 round." },
          { lo:75, hi:76, txt:"Armor malfunction (no effect if no armor); -3 AC penalty until out of combat and can fix armor." },
          { lo:77, hi:78, txt:"Poke self in eye; 1d6 damage and blinded for 1 round." },
          { lo:79, hi:80, txt:"Hit self for 50% damage." },
          { lo:81, hi:82, txt:"Severe ankle injury; lose action. 2d4 subdual damage; -2 DEX & speed reduced by 10’ until healed." },
          { lo:83, hi:84, txt:"Jam toes; stumble forward 10 feet, falling prone for 1 round." },
          { lo:85, hi:86, txt:"Slip, fall, break leg. 2d6 damage and prone for 1 round. Speed cannot exceed 10’ until healed." },
          { lo:87, hi:88, txt:"Slip, fall, bang head; unconscious for 2d4 rounds. If wearing a helmet, helmet falls off." },
          { lo:89, hi:90, txt:"Save or weapon breaks. For magical items, add +3 to each level above mundane." },
          { lo:91, hi:92, txt:"Hit self, max damage." },
          { lo:93, hi:94, txt:"Hit closest ally, max damage. If an ally is not in range, hit self." },
          { lo:95, hi:96, txt:"Hit self, double damage." },
          { lo:97, hi:97, txt:"Hit closest ally, double damage. If an ally is not in range, hit self." },
          { lo:98, hi:98, txt:"Hit self, triple damage + roll on crit table for any additional effects (no increase to damage)." },
          { lo:99, hi:99, txt:"Hit closest ally, triple damage + roll on crit table for any additional effects (no increase to damage). If an ally is not in range, hit self." },
        ],
      };

      const arr = map[category];
      for (const e of arr) {
        if (r >= e.lo && r <= e.hi) return e.txt;
      }
      return "(No result — check fumble mapping.)";
    }

    function setText(id, txt, isError=false){
      const el = document.getElementById(id);
      el.textContent = txt;
      el.className = isError ? "warn" : "";
    }

    function runLookup(){
      const raw = document.getElementById("roll").value;
      const p = parseD100(raw);
      const msg = document.getElementById("msg");

      if (!p.ok){
        msg.innerHTML = `<span class="warn">${p.err}</span>`;
        // clear outputs
        document.getElementById("critM").textContent = "—";
        document.getElementById("critS").textContent = "—";
        document.getElementById("critN").textContent = "—";
        document.getElementById("fumM").textContent  = "—";
        document.getElementById("fumS").textContent  = "—";
        document.getElementById("fumN").textContent  = "—";
        return;
      }

      const r = p.value; // 1..100, where 100 represents 00
      const shown = (r === 100) ? "00" : String(r).padStart(2,"0");
      msg.innerHTML = `<span class="ok">Showing results for roll:</span> <span class="mono">${shown}</span>`;

      document.getElementById("critM").textContent = critResult("M", r);
      document.getElementById("critS").textContent = critResult("S", r);
      document.getElementById("critN").textContent = critResult("N", r);

      document.getElementById("fumM").textContent  = fumbleResult("M", r);
      document.getElementById("fumS").textContent  = fumbleResult("S", r);
      document.getElementById("fumN").textContent  = fumbleResult("N", r);
    }

    function clearAll(){
      document.getElementById("roll").value = "";
      document.getElementById("msg").textContent = "";
      document.getElementById("critM").textContent = "—";
      document.getElementById("critS").textContent = "—";
      document.getElementById("critN").textContent = "—";
      document.getElementById("fumM").textContent  = "—";
      document.getElementById("fumS").textContent  = "—";
      document.getElementById("fumN").textContent  = "—";
      document.getElementById("roll").focus();
    }

    document.getElementById("lookupBtn").addEventListener("click", runLookup);
    document.getElementById("clearBtn").addEventListener("click", clearAll);
    document.getElementById("roll").addEventListener("keydown", (e) => {
      if (e.key === "Enter") runLookup();
    });

    // Optional: auto-run when user types a valid number
    document.getElementById("roll").addEventListener("input", () => {
      const v = document.getElementById("roll").value.trim();
      if (v === "00" || v === "0") return runLookup();
      if (/^\d{1,3}$/.test(v)) {
        const n = Number(v);
        if (n >= 1 && n <= 100) runLookup();
      }
    });
  </script>
</body>
</html>
